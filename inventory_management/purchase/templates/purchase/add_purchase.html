{% extends 'base.html' %}

{% block title %}Purchase Form{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1>Purchase Entry</h1>
    <form id="purchaseForm" method="POST" class="mt-4">
        {% csrf_token %}
        
        <!-- Row for Invoice No and Invoice Date -->
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="invoice_no">Invoice No:</label>
                <input type="text" id="invoice_no" name="invoice_no" class="form-control" placeholder="Enter Invoice No">
            </div>
            <div class="form-group col-md-6">
                <label for="invoice_date">Invoice Date:</label>
                <input type="date" id="invoice_date" name="invoice_date" class="form-control">
            </div>
        </div>
<!-- Row for Supplier Name and Supplier Details -->
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="supplier_name">Supplier Name:</label>
                <select id="supplier_name" name="supplier" class="form-control">
                    <option value="">Select Supplier</option>
                    {% for supplier in suppliers %}
                        <option value="{{ supplier.id }}">{{ supplier.name }}</option> 
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group col-md-6">
                <label for="supplier_details">Supplier Details:</label>
                <input type="text" id="supplier_details" name="supplier_details" class="form-control" readonly>
            </div>
        </div>


        <!-- Row for Item Name and Quantity -->
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="item_name">Item Name:</label>
                <select id="item_name" name="item" class="form-control">
                    {% for item in items %}
                    <option value="{{ item.id }}">{{ item.item_name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group col-md-3">
                <label for="quantity">Quantity:</label>
                <input type="number" id="quantity" name="quantity" class="form-control" placeholder="Enter Quantity">
            </div>
        </div>

        <!-- Row for Price and Total -->
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="price">Price:</label>
                <input type="number" id="price" name="price" class="form-control" readonly>
            </div>
            <div class="form-group col-md-6">
                <label for="total">Total:</label>
                <input type="number" id="total" name="total" class="form-control" readonly>
            </div>
        </div>

        <!-- Add Item Button -->
        <button type="button" id="addItem" class="btn btn-primary">Add Item</button>
    </form>

    <!-- Items List Table -->
    <h2 class="mt-5">Items</h2>
    <table id="itemsTable" class="table table-bordered mt-3">
        <thead class="thead-dark">
            <tr>
                <th>S. No</th>
                <th>Item Name</th>
                <th>Rate</th>
                <th>Quantity</th>
                <th>Total</th>
            </tr>
        </thead>
        <tbody>
            
        </tbody>
    </table>

    <h3>Sub Total: <span id="subTotal">0.00</span></h3>
    <br><br>
</div>
{% endblock %}

{% block scripts %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
    function fetchSupplierDetails() {
        var supplierId = document.getElementById('supplier_name').value;  
        
        if (supplierId) {
            fetch(`/supplier/${supplierId}/details/`)  
            .then(response => response.json())
            .then(data => {
                if (data.address) {  
                    document.getElementById('supplier_details').value = data.address;
                } else {
                    document.getElementById('supplier_details').value = "Supplier details not found";
                }
            })
            .catch(error => {
                console.error('Error fetching supplier details:', error);
                document.getElementById('supplier_details').value = "Error fetching details";
            });
        } else {
            document.getElementById('supplier_details').value = "";  
        }
    }

    
    document.getElementById('supplier_name').addEventListener('change', fetchSupplierDetails);
});
</script>
{% endblock %}